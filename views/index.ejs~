<!DOCTYPE html>
<html xmlns:fb="http://ogp.me/ns/fb#" lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=no" />
	<meta property="og:title" content="<%= app.name %>" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="<%= url() %>" />
	<meta property="og:image" content="<%= url('/logo.png') %>" />
	<meta property="og:site_name" content="<%= app.name %>" />
	<meta property="og:description" content="My first app" />
	<meta property="fb:app_id" content="<%= app.id %>" />

	<title><%= app.name %></title>
	<!-- css -->
	<link href="/stylesheets/reset.css" type=text/css rel=stylesheet>
	<link href="/stylesheets/flanet.css" type=text/css rel=stylesheet>

	<!-- basic library -->
	<script type="text/javascript" src='/scripts/kinetic-v3.9.2.js'></script>
	<script type="text/javascript" src="/scripts/jquery-1.7.2.js"></script>
	<script type="text/javascript" src='/scripts/box2djs.0.2.0.jquery.min.js'></script>

	<!-- flanet library -->
	<script type="text/javascript" src='/scripts/flanet-v1.0.5.js'></script>

	<!-- testing module -->
	<script type="text/javascript" src='/scripts/test2.js'></script>

		<!--[if IE]>
		<script type="text/javascript">
			var tags = ['header', 'section'];
			while(tags.length)
				document.createElement(tags.pop());
		</script>
		<![endif]-->
	</head>
	<body>
		<!-- fb init -->
		<div id="fb-root"></div>
		<script type="text/javascript">
		window.fbAsyncInit = function() {
			FB.init({
				appId      : '<%= app.id %>',
				channelUrl : '<%= url_no_scheme('/channel.html') %>',
				status     : true,
				cookie     : true,
				xfbml      : true
			});
			FB.Event.subscribe('auth.login', function(response) {
				window.location = window.location;
			});
			FB.Canvas.setAutoGrow();
		};
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/all.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		</script>
		<!-- Flanet Canvas -->
		<span id="title">FlanetProject - Friend + Planet</span>
		<span id="status">ver 0.3</span>
		<div id="feedTest" style="font-size:11px;"></div>
		<div id="stage"></div>
		<% if (user) { %>
		<% req.feeds.forEach(function(feed) { %>
		<div><%= feed.message %></div>
		<% }); %>
		<script>
		var user_content = {
			id : "<%= user.id %>",
			name : "<%= user.name %>",
			imgSrc : "https://graph.facebook.com/" + "<%= user.id %>" + "/picture?type=normal",
			clicked : function(){
				FB.ui(
				{
					method : 'feed',
					link   : $(this).attr('data-url')
				},
				function (response) {
					if (response != null) {
						logResponse(response);
					}
				}
				);},
				dragged : function(){
				}
			};
			var f_content = new Array();
			<% req.friends.forEach(function(friend) { %>
				f_content[f_content.length] = {
					id : "<%= friend.id %>",
					name : "<%= friend.name %>",
					imgSrc : "https://graph.facebook.com/<%= friend.id %>/picture?type=square",
					clicked : function(){
						var panel = Flanet.getCurrentWorld().getPanelById(this.id);
						if(panel)
							Flanet.getCurrentWorld().rmPanel(panel);
							/*
							var that = this;
							FB.ui(
									{
										method: 'stream.publish',
										link: $(this).attr('data-url'),
										target_id: this.id,
										display: 'iframe'
									},
									function (response) {
										if (response != null) {
											logResponse(response);
										}
									}
							);
			*/
		}
	}
	<% }); %>
			var container = "stage";
			$("#" + container).width($(window).width());
			$("#" + container).height($(window).height());
			var width = $("#" + container).width();
			var height = $("#" + container).height();
		//flanet initialize
		Flanet.init({ container : "stage"	});
		// test module setting
		addTest(width, height, width/2, height/2, 50);
		// flanet start
		Flanet.start();
		</script>
		<% } else { %>
		<fb:login-button cope="user_likes, user_photos, user_status, user_activities, publish_actions, user,groups, user_subscriptions"></fb:login-button>
		<% } %>
	</body>
	</html>